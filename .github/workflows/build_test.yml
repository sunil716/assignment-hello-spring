name : Task-1 in assignment - Build, test, package the code and uploading artifacts to different branch

on : [push, workflow_dispatch]

env:
  email: sunilgajula333@gmail.com
  username: sunil716
  pat: ${{ secrets.PAT }}

jobs :
  build-test-package : 
    runs-on : ubuntu-latest
    steps :
      - name : Getting the application code
        uses : actions/checkout@v3
      - name : Set up JDK 11
        uses : actions/setup-java@v3
        with :
          java-version : '11'
          distribution : 'temurin'
      - name : Build Stage
        run : mvn clean compile
      - name : Testing Stage
        run : mvn test
      - name : Packaging the code
        run : mvn package
      - name : Uploading the Artifact(JAR File)
        uses: actions/upload-artifact@v3
        with:
          name: jar-file
          path: target/*.jar
            
  upload-artifacts:
    needs: build-test-package
    runs-on: ubuntu-latest
    steps:
      - name: Downloading the Artifact(JAR File)
        uses: actions/download-artifact@v3
        with:
          name: jar-file
      - name: Listing all files
        run: ls -al
      - name: Commit files
        # working-directory: assignment-hello-spring/
        run: |
          git config --global user.email $email
          git config --global user.name $username
          git add .
          git commit -a -m "Adding the Artifact File(JAR File)"
          git push "https://$email:${{ secrets.PAT }}@github.com/sunil716/assignment-hello-spring.git" artifacts-store
      